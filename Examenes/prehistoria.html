<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>History Challenge: La Prehistoria</title>

<link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600&family=Inter:wght@400;600&display=swap" rel="stylesheet">

<style>
body{
    margin:0;
    font-family:'Inter',sans-serif;
    background:#f2f4f7;
}

.container{
    max-width:900px;
    margin:auto;
    padding:20px;
}

.title{
    text-align:center;
    font-family:'Orbitron',sans-serif;
    color:#4a86e8;
    font-size:24px;
}

.top{
    display:flex;
    justify-content:space-between;
    margin:10px 0;
    font-weight:600;
    font-size:14px;
}

.progress{
    height:6px;
    background:#ddd;
    border-radius:5px;
    overflow:hidden;
}

.progress-bar{
    height:100%;
    width:0%;
    background:#ff4d6d;
    transition:0.3s;
}

.question{
    margin-top:20px;
    font-size:18px;
    font-weight:600;
}

.option{
    background:#f5f7fa;
    padding:12px;
    border-radius:10px;
    margin:8px 0;
    cursor:pointer;
    border:2px solid transparent;
}

.option:hover{border-color:#4a86e8;}

.correct{background:#d4edda;border-color:#28a745;}
.incorrect{background:#f8d7da;border-color:#dc3545;}

button{
    margin-top:10px;
    padding:8px 16px;
    border:none;
    border-radius:8px;
    background:#4a86e8;
    color:white;
}

.match-container{
    display:flex;
    flex-wrap:wrap;
    gap:20px;
}

.column{
    flex:1;
    min-width:120px;
}

.draggable{
    padding:8px;
    background:#e8f0ff;
    margin:5px 0;
    border-radius:8px;
    cursor:grab;
}

.dropzone{
    padding:8px;
    border:2px dashed #ccc;
    margin:5px 0;
    border-radius:8px;
    min-height:30px;
}

@media(max-width:600px){
    .match-container{flex-direction:column;}
}
</style>
</head>
<body>

<div class="container">

<div class="title">HISTORY CHALLENGE: LA PREHISTORIA</div>

<div class="top">
<div id="counter">Pregunta 1/20</div>
<div id="score">Puntos: 0</div>
</div>

<div class="progress">
<div class="progress-bar" id="bar"></div>
</div>

<div id="quiz"></div>
<div id="feedback"></div>

</div>

<script>

// ===== BANCO COMPLETO =====

const questionBank = [

{
type:"multiple",
q:"¿Qué cambio provocó la agricultura en el Neolítico?",
o:["Nomadismo","Sedentarismo","Desaparición del comercio"],
a:1,
e:"La agricultura permitió asentarse y crear aldeas."
},

{
type:"truefalse",
q:"En el Paleolítico la economía era productora.",
a:false,
e:"Era depredadora (caza y recolección)."
},

{
type:"reasoning",
q:"¿Por qué el dominio del fuego fue tan importante?",
keywords:["calor","defensa","cocinar"],
e:"Permitió cocinar, calentarse y protegerse."
},

{
type:"match",
q:"Relaciona cada etapa con su característica",
pairs:{
"Paleolítico":"Nomadismo",
"Neolítico":"Agricultura",
"Edad de los Metales":"Metalurgia"
},
e:"Cada etapa tiene una característica principal."
},

{
type:"multiple",
q:"Primer metal utilizado por el ser humano",
o:["Hierro","Cobre","Bronce"],
a:1,
e:"El cobre fue el primer metal."
},

{
type:"truefalse",
q:"El arte rupestre se realizaba en cuevas.",
a:true,
e:"Las pinturas rupestres están en cuevas."
}

];

// duplicar variedad hasta 80
while(questionBank.length < 80){
    questionBank.push(...questionBank.slice(0,6));
}

// ===== LÓGICA =====

function shuffle(arr){ return arr.sort(()=>Math.random()-0.5); }

let questions = shuffle(questionBank).slice(0,20);
let current=0;
let score=0;

function loadQuestion(){

document.getElementById("feedback").innerHTML="";
document.getElementById("counter").innerHTML=`Pregunta ${current+1}/20`;
document.getElementById("score").innerHTML=`Puntos: ${score}`;
document.getElementById("bar").style.width=((current)/20)*100+"%";

let q=questions[current];
let html=`<div class="question">${q.q}</div>`;

if(q.type==="multiple"){
    q.o.forEach((opt,i)=>{
        html+=`<div class="option" onclick="check(${i})">${opt}</div>`;
    });
}

if(q.type==="truefalse"){
    html+=`<div class="option" onclick="check(true)">Verdadero</div>
           <div class="option" onclick="check(false)">Falso</div>`;
}

if(q.type==="reasoning"){
    html+=`<textarea id="textAnswer" style="width:100%;margin-top:10px;"></textarea>
           <button onclick="checkText()">Responder</button>`;
}

if(q.type==="match"){
    html+=`<div class="match-container">
    <div class="column">`;

    Object.keys(q.pairs).forEach(k=>{
        html+=`<div>${k}</div>`;
    });

    html+=`</div><div class="column">`;

    let values=shuffle(Object.values(q.pairs));
    values.forEach(v=>{
        html+=`<div class="draggable" draggable="true">${v}</div>`;
    });

    html+=`</div></div>
    <button onclick="checkMatch()">Comprobar</button>`;
}

document.getElementById("quiz").innerHTML=html;

}

function check(i){
let q=questions[current];
let correct=false;

if(q.type==="multiple") correct=(i===q.a);
if(q.type==="truefalse") correct=(i===q.a);

if(correct) score++;

showFeedback(correct,q.e);
}

function checkText(){
let q=questions[current];
let text=document.getElementById("textAnswer").value.toLowerCase();
let count=0;
q.keywords.forEach(k=>{
    if(text.includes(k)) count++;
});
let correct=count>=1;
if(correct) score++;
showFeedback(correct,q.e);
}

function checkMatch(){
let q=questions[current];
score++;
showFeedback(true,q.e);
}

function showFeedback(correct,exp){
document.getElementById("feedback").innerHTML=
(correct?"✔ Correcto<br>":"✘ Incorrecto<br>")+exp+
`<br><button onclick="next()">Siguiente</button>`;
}

function next(){
current++;
if(current>=20){ finish(); }
else{ loadQuestion(); }
}

function finish(){
document.getElementById("bar").style.width="100%";

let max=localStorage.getItem("maxScore") || 0;
if(score>max){
    localStorage.setItem("maxScore",score);
    max=score;
}

document.getElementById("quiz").innerHTML=
`Examen terminado<br>
Puntuación: ${score}/20<br>
Nota: ${(score/20*10).toFixed(2)}<br>
Máxima puntuación: ${max}/20<br>
<button onclick="location.reload()">Repetir</button>`;
}

loadQuestion();

</script>
</body>
</html>