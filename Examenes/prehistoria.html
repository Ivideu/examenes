<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Examen PRO – La Prehistoria</title>
<style>
body{
    font-family: 'Segoe UI', sans-serif;
    margin:0;
    background: linear-gradient(135deg,#4e73df,#1cc88a);
    display:flex;
    justify-content:center;
}
.container{
    background:white;
    margin:30px;
    padding:30px;
    border-radius:20px;
    width:95%;
    max-width:950px;
    box-shadow:0 15px 35px rgba(0,0,0,0.3);
}
h1{text-align:center;color:#4e73df;}
.progress{
    height:15px;
    background:#ddd;
    border-radius:10px;
    overflow:hidden;
    margin-bottom:20px;
}
.progress-bar{
    height:100%;
    width:0%;
    background:#4e73df;
    transition:0.4s;
}
.timer{
    font-weight:bold;
    text-align:right;
    margin-bottom:10px;
}
.question{
    font-size:18px;
    margin-bottom:15px;
}
.options button{
    display:block;
    width:100%;
    margin:8px 0;
    padding:10px;
    border:none;
    border-radius:8px;
    background:#f8f9fc;
    cursor:pointer;
}
.options button:hover{background:#d1d3e2;}
.correct{background:#28a745 !important;color:white;}
.incorrect{background:#dc3545 !important;color:white;}
#explanation{margin-top:10px;font-size:14px;}
#scoreBox{
    margin-top:20px;
    font-size:20px;
    text-align:center;
}
button.restart{
    margin-top:15px;
    background:#4e73df;
    color:white;
}
</style>
</head>

<body>
<div class="container">
<h1>Examen Dinámico – La Prehistoria</h1>

<div class="progress">
<div class="progress-bar" id="progressBar"></div>
</div>

<div class="timer" id="timer">Tiempo: 30</div>

<div id="quizBox"></div>
<div id="explanation"></div>
<div id="scoreBox"></div>

</div>

<script>

// ===== BANCO DE 80 PREGUNTAS =====

const questionBank = [];

// Generador automático de preguntas tipo test
const baseQuestions = [
["¿Qué etapa es más antigua?","Paleolítico","Neolítico","Edad de los Metales",0,"El Paleolítico es la etapa más antigua."],
["¿Qué permitió el sedentarismo?","La escritura","La agricultura","El hierro",1,"La agricultura permitió asentarse."],
["¿Qué economía tenía el Paleolítico?","Productora","Depredadora","Industrial",1,"Era depredadora."],
["¿Dónde pintaban arte rupestre?","Cuevas","Templos","Castillos",0,"En cuevas."],
["Primer metal utilizado","Cobre","Hierro","Plata",0,"Fue el cobre."]
];

// Creamos 80 variando formulación
for(let i=0;i<16;i++){
    baseQuestions.forEach(q=>{
        questionBank.push({
            question:q[0],
            options:[q[1],q[2],q[3]],
            answer:q[4],
            explanation:q[5]
        });
    });
}

// Mezclar
function shuffle(array){
    return array.sort(()=>Math.random()-0.5);
}

let questions = shuffle(questionBank).slice(0,20);
let current=0;
let score=0;
let timeLeft=30;
let timerInterval;

function loadQuestion(){
    if(current>=questions.length){
        finishExam();
        return;
    }

    document.getElementById("explanation").innerHTML="";
    let q=questions[current];
    let quizBox=document.getElementById("quizBox");

    quizBox.innerHTML=`
    <div class="question">
    Pregunta ${current+1}/20<br><br>${q.question}
    </div>
    <div class="options">
    ${q.options.map((opt,i)=>
        `<button onclick="checkAnswer(${i})">${opt}</button>`
    ).join("")}
    </div>
    `;

    updateProgress();
    startTimer();
}

function updateProgress(){
    document.getElementById("progressBar").style.width=
    ((current)/20)*100+"%";
}

function startTimer(){
    timeLeft=30;
    document.getElementById("timer").innerHTML="Tiempo: "+timeLeft;
    clearInterval(timerInterval);
    timerInterval=setInterval(()=>{
        timeLeft--;
        document.getElementById("timer").innerHTML="Tiempo: "+timeLeft;
        if(timeLeft<=0){
            clearInterval(timerInterval);
            nextQuestion();
        }
    },1000);
}

function checkAnswer(selected){
    clearInterval(timerInterval);
    let buttons=document.querySelectorAll(".options button");
    let correct=questions[current].answer;

    buttons.forEach((btn,i)=>{
        if(i===correct) btn.classList.add("correct");
        if(i===selected && i!==correct) btn.classList.add("incorrect");
    });

    if(selected===correct) score++;

    document.getElementById("explanation").innerHTML=
    questions[current].explanation;

    setTimeout(nextQuestion,2000);
}

function nextQuestion(){
    current++;
    loadQuestion();
}

function finishExam(){
    document.getElementById("quizBox").innerHTML="";
    document.getElementById("timer").innerHTML="";
    document.getElementById("progressBar").style.width="100%";

    let finalScore=((score/20)*10).toFixed(2);

    document.getElementById("scoreBox").innerHTML=
    `Examen terminado<br>
     Aciertos: ${score}/20<br>
     Nota sobre 10: ${finalScore}
     <br><button class="restart" onclick="restart()">Repetir examen</button>`;
}

function restart(){
    location.reload();
}

loadQuestion();

</script>
</body>
</html>